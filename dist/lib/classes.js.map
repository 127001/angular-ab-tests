{"version":3,"file":"classes.js","sourceRoot":"","sources":["../../lib/classes.ts"],"names":[],"mappings":"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","sourcesContent":["import { error } from './error';\n\nexport class AbTestForRealUser {\n  private _versions: string[] = [];\n  private _chosenVersion: string;\n\n  constructor(versions: string[], chosenVersion: string) {\n    this._versions = versions;\n    this._chosenVersion = chosenVersion;\n  }\n\n  shouldRender(versions: string[], forCrawlers: boolean): boolean {\n    for (let version of versions) {\n      if (this._versions.indexOf(version) === -1) {\n        error('Version <' + version + '> has not been declared: [ ' + this._versions.join(', ') + ' ]');\n      }\n    }\n    return (versions.indexOf(this._chosenVersion) !== -1);\n  }\n}\n\nexport class AbTestForCrawler {\n  private _version: string;\n\n  constructor(version?: string) {\n    if (!!version) {\n      this._version = version;\n    }\n  }\n\n  shouldRender(versions: string[], forCrawlers: boolean): boolean {\n    return forCrawlers || (!!this._version && versions.indexOf(this._version) !== -1);\n  }\n}\n\nexport class RandomExtractor {\n  private _weights: [number, string][];\n  private _versions: string[];\n\n  setWeights(weights: [number, string][]) {\n    this._weights = weights;\n  }\n\n  setVersions(versions: string[]) {\n    this._versions = versions;\n  }\n\n  run(): string {\n    if (this._weights.length === 0) {\n      return this._versions[Math.floor(Math.random() * this._versions.length)];\n    }\n    let random: number = Math.random() * 100;\n    for (let weight of this._weights) {\n      if (random <= weight[0]) {\n        return weight[1];\n      }\n    }\n    return this._versions[0];\n  }\n}\n\nexport class CrawlerDetector {\n  private _regexps: RegExp[] = [\n    /bot/i, /spider/i, /facebookexternalhit/i, /simplepie/i, /yahooseeker/i, /embedly/i,\n    /quora link preview/i, /outbrain/i, /vkshare/i, /monit/i, /Pingability/i, /Monitoring/i,\n    /WinHttpRequest/i, /Apache-HttpClient/i, /getprismatic.com/i, /python-requests/i, /Twurly/i,\n    /yandex/i, /browserproxy/i, /Monitoring/i, /crawler/i, /Qwantify/i, /Yahoo! Slurp/i, /pinterest/i\n  ];\n\n  isCrawler() {\n    return this._regexps.some(function (crawler) {\n      return crawler.test(window.navigator.userAgent)\n    });\n  }\n}\n\nexport class CookieHandler {\n  public get(name: string): string {\n    name = encodeURIComponent(name);\n    let regexp: RegExp = new RegExp('(?:^' + name + '|;\\\\s*' + name + ')=(.*?)(?:;|$)', 'g');\n    let results = regexp.exec(document.cookie);\n    return (!results) ? '' : decodeURIComponent(results[1]);\n  }\n\n  public set(name: string, value: string, domain?: string, expires?: number) {\n    let cookieStr = encodeURIComponent(name) + '=' + encodeURIComponent(value) + ';';\n    if (expires) {\n      let dtExpires = new Date(new Date().getTime() + expires * 1000 * 60 * 60 * 24);\n      cookieStr += 'expires=' + dtExpires.toUTCString() + ';';\n    }\n    if (domain) {\n      cookieStr += 'domain=' + domain + ';';\n    }\n    document.cookie = cookieStr;\n  }\n}\n"]}